# ─────────────────────────────────────────────────────
# Empliq Scraper API — Despliegue LOCAL
#
# Corre el scraper en tu PC con tu IP residencial
# para bypasear Cloudflare en datosperu.org.
#
# Uso:
#   docker compose -f deploy-local/docker-compose.local.yml up -d --build
#   docker compose -f deploy-local/docker-compose.local.yml logs -f
#   docker compose -f deploy-local/docker-compose.local.yml down
# ─────────────────────────────────────────────────────

services:
  scraper-local:
    container_name: empliq-scraper-local
    build:
      context: ..
      dockerfile: deploy-local/Dockerfile.local
    ports:
      - "3458:3457"    # 3458 local → 3457 dentro del container
    environment:
      - SCRAPER_PORT=3457
      - API_KEY=cbbee76f8bed4061fe85a0a3c5d459d9e85dade42a0b4c11575032a0d52680ba
      - DATOSPERU_DIRECT=true   # ← Usa IP residencial primero, proxy fallback
      - NODE_ENV=production
    restart: unless-stopped
    healthcheck:
      test: ["CMD", "wget", "--no-verbose", "--tries=1", "--spider", "http://localhost:3457/search/health"]
      interval: 30s
      timeout: 10s
      start_period: 15s
      retries: 3
    # Limitar recursos para no afectar tu PC
    deploy:
      resources:
        limits:
          memory: 512M
          cpus: "1.0"
